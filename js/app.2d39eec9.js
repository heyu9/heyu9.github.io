(function(e){function t(t){for(var o,l,r=t[0],n=t[1],c=t[2],d=0,u=[];d<r.length;d++)l=r[d],Object.prototype.hasOwnProperty.call(i,l)&&i[l]&&u.push(i[l][0]),i[l]=0;for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);p&&p(t);while(u.length)u.shift()();return s.push.apply(s,c||[]),a()}function a(){for(var e,t=0;t<s.length;t++){for(var a=s[t],o=!0,r=1;r<a.length;r++){var n=a[r];0!==i[n]&&(o=!1)}o&&(s.splice(t--,1),e=l(l.s=a[0]))}return e}var o={},i={app:0},s=[];function l(t){if(o[t])return o[t].exports;var a=o[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,l),a.l=!0,a.exports}l.m=e,l.c=o,l.d=function(e,t,a){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(l.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)l.d(a,o,function(t){return e[t]}.bind(null,o));return a},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],n=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var p=n;s.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"0404":function(e,t,a){"use strict";a("7385")},1:function(e,t){},"17cf":function(e,t,a){},"31a3":function(e,t,a){},3954:function(e,t,a){},"49fd":function(e,t,a){"use strict";a("64c6")},"533d":function(e,t,a){"use strict";a("3954")},"56d7":function(e,t,a){"use strict";a.r(t);var o=a("430a"),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},s=[],l=(a("5c0b"),a("4ac2")),r={},n=Object(l["a"])(r,i,s,!1,null,null,null),c=n.exports,p=a("8aaf"),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("Map",{on:{map:e.getMap}})],1)},u=[],m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"map_box"},[a("div",{staticClass:"map_tool"},[a("div",{staticClass:"tool_item",on:{click:function(t){e.showMapSelect=!e.showMapSelect}}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"底图选择",placement:"bottom"}},[a("i",{staticClass:"iconfont icon-morenditu",style:{color:e.showMapSelect?"#f56c6c":"#333"}})])],1),a("div",{staticClass:"tool_item",on:{click:function(t){return e.ranging()}}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"测距",placement:"bottom"}},[a("i",{staticClass:"iconfont icon-ceju",style:{color:e.measureLengthState?"#f56c6c":"#333"}})])],1),a("div",{staticClass:"tool_item",on:{click:function(t){return e.chooseSite()}}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"坐标拾取",placement:"bottom"}},[a("i",{class:["iconfont","icon-yingyong"],style:{"font-weight":"bold",color:e.isChoosed?"#f56c6c":"#333"}})])],1)]),a("div",{staticClass:"map_wrap",style:{"z-index":e.mapMode?"9999":"0"}},[a("div",{staticClass:"mapBox"}),a("div",{staticClass:"basemap_container",attrs:{id:"base_map"}}),a("div",{staticClass:"map_container",attrs:{id:e.map_ID}})]),a("div",{staticClass:"map_size"},[e._v("地图级别:"+e._s(e.mapSize))]),a("div",{staticClass:"tool_box"},[0===e.cur_tool?a("div",{staticClass:"tool_search"},[a("div",{staticClass:"input_box"},[a("el-input",{attrs:{size:"mini",clearable:"",placeholder:"请输入地点查询"},on:{input:e.mapSearch},model:{value:e.searchInfo,callback:function(t){e.searchInfo=t},expression:"searchInfo"}})],1),a("div",{staticClass:"result_box"},e._l(e.searchResult,(function(t,o){return a("div",{key:o,staticClass:"item",on:{click:function(a){return e.toSearchPoi(t)}}},[a("div",{staticClass:"head"},[a("div",{staticClass:"name"},[e._v(e._s(o+1)+"、"+e._s(t.name))]),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.adname))])],1),a("div",{staticClass:"cont"},[e._v(e._s(t.address))])])})),0)]):e._e(),1===e.cur_tool?a("div",{staticClass:"layer_style"},[a("div",{staticClass:"color_map"},[a("div",{staticClass:"color_item"},[a("el-color-picker",{attrs:{"show-alpha":"",size:"mini"},on:{change:function(t){return e.symbolColorChange()}},model:{value:e.color_symbol,callback:function(t){e.color_symbol=t},expression:"color_symbol"}}),a("div",{staticClass:"color_label"},[e._v("文字")])],1),a("div",{staticClass:"color_item"},[a("el-color-picker",{attrs:{"show-alpha":"",size:"mini"},on:{change:function(t){return e.borderColorChange()}},model:{value:e.color_border,callback:function(t){e.color_border=t},expression:"color_border"}}),a("div",{staticClass:"color_label"},[e._v("描边")])],1),a("div",{staticClass:"color_item"},[a("el-color-picker",{attrs:{"show-alpha":"",size:"mini"},on:{change:function(t){return e.fillColorChange()}},model:{value:e.color_fill,callback:function(t){e.color_fill=t},expression:"color_fill"}}),a("div",{staticClass:"color_label"},[e._v("填充")])],1)]),a("div",{staticStyle:{border:"rgba(96,92,92,0.5) 1px solid",margin:"10px 0"}}),a("div",{staticClass:"tool_opacity"},[a("div",{staticClass:"opacity_fill"},[a("span",{staticClass:"demonstration"},[e._v("图层填充透明度："+e._s(e.fill_opacity))]),a("el-slider",{attrs:{step:.1,min:0,max:1,"show-stops":""},on:{change:function(t){return e.fillOpacityChange()}},model:{value:e.fill_opacity,callback:function(t){e.fill_opacity=t},expression:"fill_opacity"}})],1),a("div",{staticClass:"opacity_border"},[a("span",{staticClass:"demonstration"},[e._v("图层描边透明度："+e._s(e.border_opacity))]),a("el-slider",{attrs:{step:.1,min:0,max:1,"show-stops":""},on:{change:function(t){return e.borderOpacityChange()}},model:{value:e.border_opacity,callback:function(t){e.border_opacity=t},expression:"border_opacity"}})],1)]),a("div",{staticStyle:{border:"rgba(96,92,92,0.5) 1px solid",margin:"10px 0"}}),a("div",{staticClass:"plate_layer"})]):e._e(),2===e.cur_tool?a("div",{}):e._e(),3===e.cur_tool?a("div",{staticClass:"tool_layer"},[a("div",{staticClass:"tool_wrap"})]):e._e(),e.showMapSelect?a("div",{staticClass:"tool_basicmap"},[a("el-radio-group",{on:{change:e.changeBsicMap},model:{value:e.curBasicmap,callback:function(t){e.curBasicmap=t},expression:"curBasicmap"}},e._l(e.basicMap,(function(t,o){return a("el-radio",{key:o,attrs:{label:t.url}},[e._v(e._s(t.name))])})),1)],1):e._e(),5===e.cur_tool?a("div",{staticClass:"tool_enclosure"},[a("div",{staticClass:"tool_wrap"},[a("el-radio-group",{on:{change:e.changeEnclosure},model:{value:e.curEnclosure,callback:function(t){e.curEnclosure=t},expression:"curEnclosure"}},e._l(e.enclosureType,(function(t,o){return a("el-radio",{key:o,attrs:{label:t.value}},[e._v(e._s(t.name))])})),1)],1),"isochronous"===e.curEnclosure?a("div",{staticClass:"isochronous_box"},[a("Isocircle",{attrs:{startCoordinate:e.isoPoint},on:{geojson:e.setIsochronous}})],1):e._e()]):e._e()]),a("input",{ref:"input",staticStyle:{opacity:"0",position:"fixed","z-index":"-99999"},attrs:{type:"text"}})])},h=[],y=a("0be3"),g=a.n(y),f=a("1f62"),v=a("3977"),_=a("404d"),b=a.n(_),C=a("c65b"),L=a.n(C),w=a("1ebd"),S=a.n(w);S.a.enc.Utf8.parse("1234123412ABCDEF"),S.a.enc.Utf8.parse("ABCDEF1234123412");function x(e){let t=[];return""!=e&&L.a.ajax({type:"get",url:"https://restapi.amap.com/v3/place/text",cache:!1,async:!1,dataType:"json",data:{key:"d222a0cc9d49fe7a60ab4b123a20c34a",keywords:e,citylimit:!0,extensions:"base"},success:e=>{console.log("地点查询结果"),console.log(e),e&&"1"===e.status&&(t=e.pois)}}),t}function M(e,t){var a=3.141592653589793,o=6378245,i=.006693421622965943;t=+t,e=+e;if(u(e,t))return[e,t];var s=m(e-105,t-35),l=h(e-105,t-35),r=t/180*a,n=Math.sin(r);n=1-i*n*n;var c=Math.sqrt(n);s=180*s/(o*(1-i)/(n*c)*a),l=180*l/(o/c*Math.cos(r)*a);var p=t+s,d=e+l;return[2*e-d,2*t-p];function u(e,t){t=+t,e=+e;return!(e>73.66&&e<135.05&&t>3.86&&t<53.55)}function m(e,t){t=+t,e=+e;var o=2*e-100+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return o+=2*(20*Math.sin(6*e*a)+20*Math.sin(2*e*a))/3,o+=2*(20*Math.sin(t*a)+40*Math.sin(t/3*a))/3,o+=2*(160*Math.sin(t/12*a)+320*Math.sin(t*a/30))/3,o}function h(e,t){t=+t,e=+e;var o=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return o+=2*(20*Math.sin(6*e*a)+20*Math.sin(2*e*a))/3,o+=2*(20*Math.sin(e*a)+40*Math.sin(e/3*a))/3,o+=2*(150*Math.sin(e/12*a)+300*Math.sin(e/30*a))/3,o}}var k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"isocircle_wrap"},[a("div",{staticClass:"condition"},[a("label",[e._v("出行方式：")]),a("el-select",{attrs:{size:"mini"},on:{change:e.travelTypeChange},model:{value:e.curType,callback:function(t){e.curType=t},expression:"curType"}},e._l(e.travelType,(function(e,t){return a("el-option",{key:t,attrs:{disabled:e.disabled,label:e.label,value:e.value}})})),1)],1),a("div",{staticClass:"condition"},[a("label",[e._v("出行时间：")]),a("el-select",{attrs:{size:"mini"},on:{change:e.travelTimeChange},model:{value:e.curTime,callback:function(t){e.curTime=t},expression:"curTime"}},e._l(e.travelTime,(function(e,t){return a("el-option",{key:t,attrs:{disabled:e.disabled,label:e.label,value:e.value}})})),1)],1),a("div",{staticClass:"tip"},[e._v("tips:地图上点击确定等时圈起始点,拖动点更改位置")])])},P=[],T={name:"isocircle",props:{startCoordinate:{type:String,default:""}},components:{},data(){return{accessToken:"pk.eyJ1Ijoibm9jb25yaWFuZGVyIiwiYSI6ImNrMjQ1dGNrNDIwdWMzZXVnN3VwbnV4NW4ifQ.D7k8xizdEAG4ucy3vAhNFg",travelType:[{label:"驾车",value:"driving",disabled:!1},{label:"步行",value:"walking",disabled:!1},{label:"骑行",value:"cycling",disabled:!1}],curType:"driving",travelTime:[{label:"15",value:"15",disabled:!1},{label:"30",value:"30",disabled:!1},{label:"45",value:"45",disabled:!1},{label:"60",value:"60",disabled:!1}],curTime:"15"}},watch:{startCoordinate:{handler(e){console.log(e),this.mapboxIsoline()}}},methods:{travelTypeChange(){this.mapboxIsoline()},travelTimeChange(){this.mapboxIsoline()},mapboxIsoline(){let e="https://api.mapbox.com/isochrone/v1/mapbox/"+this.curType+"/"+this.startCoordinate+"?contours_minutes="+this.curTime+"&polygons=true&access_token="+this.accessToken;this.$.ajax({type:"get",async:!1,url:e,dataType:"json",success:e=>{this.$emit("geojson",e)},error:function(){console.log("fail")}})}}},j=T,E=(a("533d"),Object(l["a"])(j,k,P,!1,null,null,null)),F=E.exports,A={name:"city_map",props:{mapType:{type:String,default:"dataQuery"}},components:{Isocircle:F},data(){return{isChoosed:!1,map_ID:"mapbox_map",showMapSelect:!1,mapMode:!1,measureLengthState:!1,measureAreaState:!1,points:[],jsonPoint:{type:"FeatureCollection",features:[]},jsonLine:{type:"FeatureCollection",features:[]},markers:[],base_map:null,local_map:null,mapSize:9,heigth_false:window.innerHeight-33+"px",heigth_true:window.innerHeight-200+"px",height_ohter:window.innerHeight+"px",layerArr:[],layer_3dbuilding:!1,tools:[{name:"搜索",icon:"el-icon-search",show:!0},{name:"板块样式",icon:"el-icon-set-up",show:!0},{name:"透明度",icon:"el-icon-s-help",show:!1},{name:"图层",icon:"el-icon-s-grid",show:!1},{name:"底图",icon:"el-icon-location-information",show:!1},{name:"围栏",icon:"el-icon-crop",show:!1},{name:"文章留言",icon:"el-icon-chat-dot-round",show:!0},{name:"用户使用手册",icon:"el-icon-question",show:!0}],map_draw:null,cur_tool:null,searchInfo:"",searchResult:[],curBasicmap:"mapbox://styles/noconriander/ckjxqgg190k8q17qib182syt7",basicMap:[{name:"默认地图",url:"mapbox://styles/noconriander/ckjxqgg190k8q17qib182syt7"},{name:"卫星地图",url:"mapbox://styles/noconriander/ck3e3v9w74je21dod3xdvro6u"},{name:"街道地图",url:"mapbox://styles/noconriander/ckhn5n4xt0a8j1apx3pvnqgei"},{name:"暗色地图",url:"mapbox://styles/noconriander/cknihe9io0j4017odnittuw8e"},{name:"亮色地图",url:"mapbox://styles/noconriander/cknihl8w80j9817p5g64nycg7"}],enclosureType:[{name:"半径圆",value:"circle"},{name:"自定义多边形",value:"polygon"},{name:"等时圈",value:"isochronous"}],curEnclosure:null,isoPoint:"",colors:[],color_symbol:"rgba(255, 255, 255, 1)",color_border:"rgba(149, 149, 246,1)",color_fill:"rgba(58, 88, 125, 1)",fill_opacity:.2,border_opacity:.4,tooltip:null,measureTip:null,screenWidth:""}},beforeMount(){this.map_ID="mapbox_map"+parseInt(1e5*Math.random()),this.colors=this.plate_color,setTimeout(()=>{this.mapSet()},100)},mounted(){window.addEventListener("resize",(function(){return(()=>{window.screenWidth=document.body.clientWidth,this.screenWidth=window.screenWidth})()}))},watch:{cur_tool:{handler(e){let t=this.local_map,a=t.getLayer("searchPoints");void 0!==a&&(0===e?t.setLayoutProperty("searchPoints","visibility","visible"):t.setLayoutProperty("searchPoints","visibility","none")),5!==e&&(this.changeEnclosure(null),this.curEnclosure=null)}},screenWidth:{handler(e){null!==this.base_map&&(this.base_map.resize(),this.local_map.resize())},immediate:!0}},methods:{chooseSite(){this.isChoosed=!this.isChoosed,this.isChoosed?this.local_map.on("click",this.mapHadle):this.local_map.off("click",this.mapHadle)},mapHadle(e){this.$refs.input.value=e.lngLat.lng+","+e.lngLat.lat,this.$refs.input.select(),document.execCommand("Copy"),console.log(this),this.$message({message:"坐标复制成功",type:"success"})},mapModeChange(){this.mapMode=!this.mapMode,this.local_map.setLayoutProperty("plate_fill","visibility",this.mapMode?"none":"visible"),this.local_map.setLayoutProperty("plate_line","visibility",this.mapMode?"none":"visible"),this.local_map.setLayoutProperty("plate_labels","visibility",this.mapMode?"none":"visible"),this.local_map.setLayoutProperty("landOutline_fill","visibility",this.mapMode?"none":"visible"),this.local_map.setLayoutProperty("landOutline_line","visibility",this.mapMode?"none":"visible"),this.local_map.setLayoutProperty("landOutline_line_ps","visibility",this.mapMode?"none":"visible"),this.local_map.setLayoutProperty("landpoint_label","visibility",this.mapMode?"none":"visible"),this.local_map.setLayoutProperty("layer_point","visibility",this.mapMode?"none":"visible"),this.local_map.setLayoutProperty("layer_line","visibility",this.mapMode?"none":"visible"),this.local_map.setLayoutProperty("layer_line_symbol","visibility",this.mapMode?"none":"visible"),this.local_map.setLayoutProperty("cityNum","visibility",this.mapMode?"none":"visible")},ranging(){this.measureLengthState=!this.measureLengthState,this.measureLengthState&&(this.measureAreaState=!1,this.measureLength())},surveyArea(){this.measureAreaState=!this.measureAreaState,this.measureAreaState&&(this.measureLengthState=!1,this.measureArea())},mapSearch(e){let t=x(e);console.log(t),this.searchResult=t;let a={type:"FeatureCollection",features:[]};t.forEach((e,t)=>{let o=e.location.split(",");a.features.push({type:"Feature",geometry:{type:"Point",coordinates:M(o[0],o[1])},properties:{name:e.name,index:t+1,type:e.type,address:e.address}})});let o=this.local_map,i=o.getSource("source_searchPois");void 0==i&&(o.addSource("source_searchPois",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),o.addLayer({id:"searchPoints",type:"symbol",source:"source_searchPois",layout:{"icon-image":"poimarker","text-field":"{index}","icon-allow-overlap":!0,"icon-ignore-placement":!0,"text-offset":[0,-1],"text-anchor":"top","text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":13,"icon-size":.5,visibility:"visible"},paint:{"text-opacity":1,"text-color":"#fff"}})),o.getSource("source_searchPois").setData(a)},toSearchPoi(e){e.location.split(",")},mapFlyTo(e,t){var a=this.local_map;a.flyTo({center:e,zoom:t,speed:.8,curve:2})},toolClick(e,t){7!==e?(e==this.cur_tool?(this.cur_tool=null,5===e&&(this.$store.dispatch("setEnclosure",!1),this.$store.dispatch("setEnclosureCoor",null))):(this.cur_tool=e,5===e&&(this.$store.dispatch("setEnclosure",!0),this.$store.dispatch("setEnclosureCoor",null))),"文章留言"===t.name&&this.$store.dispatch("setShowMessage",this.cur_tool===e)):window.open("http://118.190.150.38:8282/dmc-web/files/template/投资云地图操作指南.pdf","_blank")},fillOpacityChange(){this.local_map.setPaintProperty("plate_fill","fill-opacity",this.fill_opacity)},borderOpacityChange(){this.local_map.setPaintProperty("plate_line","line-opacity",this.border_opacity)},symbolColorChange(){this.local_map.setPaintProperty("plate_labels","text-color",this.color_symbol)},borderColorChange(){this.local_map.setPaintProperty("plate_line","line-color",this.color_border)},fillColorChange(){console.log(this.color_fill),this.local_map.setPaintProperty("plate_fill","fill-color",this.color_fill)},layer3dChange(){var e=this.local_map;let t=e.getLayer("layer_3dbuilding");if(this.layer_3dbuilding)if(void 0===t){let t=this.cityCode;var a="touziyun:"+t+"_3dbuilding";let o=this.geoserverURL+"/geoserver/gwc/service/tms/1.0.0/"+a+"@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf";e.addSource("layer_3dbuilding_resource",{type:"vector",scheme:"tms",tiles:[o]}),e.addLayer({id:"layer_3dbuilding",source:"layer_3dbuilding_resource","source-layer":t+"_3dbuilding",type:"fill-extrusion",minzoom:13,paint:{"fill-extrusion-color":"#91aed2","fill-extrusion-height":["interpolate",["linear"],["zoom"],13,0,15.05,["to-number",["get","height"]]],"fill-extrusion-opacity":.6},layout:{visibility:"visible"}},"plate_fill"),e.moveLayer("plate_fill","layer_3dbuilding"),e.on("click","layer_3dbuilding",e=>{})}else e.setLayoutProperty("layer_3dbuilding","visibility","visible");else e.setLayoutProperty("layer_3dbuilding","visibility","none")},changeBsicMap(e){this.base_map.setStyle(e),this.local_map.off("click",this.mapHadle),this.isChoosed=!1},changeEnclosure(e){console.log(e);let t=this.local_map;this.map_draw.getAll().features.length>0&&this.map_draw.deleteAll();let a=document.getElementsByClassName("measure_result"),o=a.length;if(a.length>0)for(let s=0;s<o;s++)a[0].remove();let i=t.getSource("isoline_source");i&&t.getSource("isoline_source").setData({type:"FeatureCollection",features:[]}),null!==e?(this.local_map.getCanvas().style.cursor="crosshair","circle"===e?this.map_draw.changeMode("drag_circle"):"polygon"===e?this.map_draw.changeMode("draw_polygon"):"isochronous"===e&&this.map_draw.changeMode("draw_point")):this.local_map.getCanvas().style.cursor=""},plateTypeChange(e){var t=this.local_map,a=["==","type",e];t.setFilter("plate_fill",a),t.setFilter("plate_line",a),t.setFilter("plate_labels",a),this.borderOpacityChange(),this.symbolColorChange(),this.borderColorChange(),this.fillColorChange()},mapSet(){var e=this;if(e.mbgl.accessToken="pk.eyJ1Ijoibm9jb25yaWFuZGVyIiwiYSI6ImNrbXliMnRsejAyYWYyd28wc3RxYzN3ZjEifQ.9iGOZBik4yAVuNKMgrPPsA",e.mbgl.supported()){e.mbgl.Compare=b.a;localStorage.getItem("cityCenter");var t=new e.mbgl.Map({container:"base_map",style:this.curBasicmap,center:["108.26150788281248","31.69572366743195"],zoom:4.8,pitch:0,localIdeographFontFamily:"MSYH"}),a=new e.mbgl.Map({container:e.map_ID,style:"mapbox://styles/noconriander/ckh5y3gd405kv19pavciyo2fu",center:["108.26150788281248","31.69572366743195"],zoom:4.8,pitch:0,localIdeographFontFamily:"MSYH"});new e.mbgl.Compare(t,a,".mapBox",{});e.$emit("map",a),e.local_map=a,e.base_map=t;var o=new g.a({modes:{...g.a.modes,draw_circle:f["a"],drag_circle:f["c"],direct_select:f["b"],simple_select:f["d"]},keybindings:!0,displayControlsDefault:!1,controls:{polygon:!1,line_string:!1,point:!1,trash:!0}});this.map_draw=o,a.addControl(new e.mbgl.NavigationControl,"top-right"),a.addControl(o,"bottom-left"),a.on("load",e=>{}),e.mapEvent(),e.measureEvent(),a.loadImage("http://47.104.165.136:8099/test/poi-marker1.png",(e,t)=>{if(e)throw e;a.addImage("poimarker",t)})}else alert("该浏览器不支持Mapbox GL,请更换浏览器")},loadMapLayers(){let e=this.local_map;e.on("load",()=>{e.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),e.addLayer({id:"sky",type:"sky",paint:{"sky-type":"gradient","sky-gradient":["interpolate",["linear"],["sky-radial-progress"],.8,"rgba(135, 206, 235, 1.0)",1,"rgba(0,0,0,0.1)"],"sky-gradient-center":[0,0],"sky-gradient-radius":90,"sky-opacity":["interpolate",["exponential",.1],["zoom"],5,0,22,1]}})})},geoserverLayerLoad(){let e=this.local_map;var t=this.cityCode?this.cityCode:"510100",a=this.geoserverURL+"/geoserver/gwc/service/tms/1.0.0/city_100000:city_polygon@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf";e.addSource("serverLayer_plates",{type:"vector",scheme:"tms",tiles:[a]}),e.addLayer({id:"plate_fill",type:"fill",source:"serverLayer_plates","source-layer":"city_polygon",filter:["==","tree_level",3],paint:{"fill-color":this.color_fill,"fill-opacity":["case",["boolean",["feature-state","hover"],!1],.1,this.fill_opacity]},layout:{visibility:"citymap"==this.landTypeTab?"none":"visible"}}),e.addLayer({id:"plate_line",type:"line",source:"serverLayer_plates","source-layer":"city_polygon",filter:["==","tree_level",3],layout:{visibility:"citymap"==this.landTypeTab?"none":"visible"},paint:{"line-color":this.color_border,"line-width":["case",["boolean",["feature-state","hover"],!1],2.5,1],"line-opacity":this.border_opacity}}),e.addLayer({id:"plate_labels",type:"symbol",source:"serverLayer_plates","source-layer":"city_polygon",filter:["==","tree_level",3],layout:{"text-field":["get","name"],"text-allow-overlap":!1,"text-size":10,visibility:"citymap"==this.landTypeTab?"none":"visible"},paint:{"text-opacity":1,"text-color":this.color_symbol,"text-halo-color":"rgba(0,0,0,0.8)","text-halo-width":1.5,"text-halo-blur":.5}});let o=["all",["==","tree_level",3],["==","pid",JSON.parse(t)]];e.setFilter("plate_fill",o),e.setFilter("plate_line",o),e.setFilter("plate_labels",o),this.$(".menu_toggle").on("click",()=>{e.resize(),e.flyTo({center:this.plateData.curCityInfo.center,zoom:9,speed:.8,curve:2})})},mapEvent(){var e=this,t=e.local_map;t.on("mouseleave","plate_fill",e=>{}),t.on("click","plate_fill",e=>{}),t.on("mouseup",t=>{if(5===e.cur_tool&&"dataQuery"===e.mapType&&e.map_draw.getAll().features.length>0){let o=e.map_draw.getAll();console.log(o);let i=document.getElementsByClassName("measure_result"),s=i.length;if(i.length>0)for(let e=0;e<s;e++)i[0].remove();let l="";if("circle"===e.curEnclosure){let t=o.features[0].properties.radiusInKm;if(t){let a=t.toFixed(2),i=o.features[0].properties.center;e.addMeasureRes(i,`半径:${a} km`),e.local_map.getCanvas().style.cursor=""}let a=o.features[0].geometry.coordinates[0];a.forEach(e=>{l+=`${e[0]},${e[1]};`}),e.$store.dispatch("setEnclosureCoor",l),console.log(l)}else if("polygon"===e.curEnclosure){let t=e.map_draw.getAll(),o=t.features[0].geometry.coordinates[0];if(o.length>2){let i=[];if(o.forEach((t,a)=>{if(a<o.length-1){let s=v["point"](t),l=v["point"](o[a+1]),r={units:"kilometers"},n=JSON.parse(v["distance"](s,l,r).toFixed(2)),c=v["midpoint"](s,l).geometry.coordinates;console.log(n,c),n>0&&(e.addMeasureRes(c,n+" km"),i.push(v["point"](t)))}}),o.length>3){var a=v["featureCollection"](i);let s=v["center"](a).geometry.coordinates,r=v["polygon"]([o]),n=v["area"](r),c=(n/1e6).toFixed(2);e.addMeasureRes(s,c+" k㎡");let p=t.features[0].geometry.coordinates[0];p.forEach(e=>{l+=`${e[0]},${e[1]};`}),e.$store.dispatch("setEnclosureCoor",l),console.log(l)}}}else if("isochronous"===e.curEnclosure){console.log(t);let a=o.features[0].geometry.coordinates;a.length>0?(e.isoPoint=a[0].toFixed(6)+","+a[1].toFixed(6),e.addMeasureRes(a,"起始点")):(e.isoPoint=t.lngLat.lng.toFixed(6)+","+t.lngLat.lat.toFixed(6),e.addMeasureRes([t.lngLat.lng,t.lngLat.lat],"起始点")),e.local_map.getCanvas().style.cursor=""}}}),t.on("zoom",a=>{e.mapSize=t.getZoom().toFixed(2)});var a=new e.mbgl.Popup({closeButton:!1,closeOnClick:!1});t.on("mousemove","searchPoints",(function(e){t.getCanvas().style.cursor="pointer";let o=[e.lngLat.lng,e.lngLat.lat];while(Math.abs(e.lngLat.lng-o[0])>180)o[0]+=e.lngLat.lng>o[0]?360:-360;var i=e.features[0].properties.name,s=e.features[0].properties.address,l=e.features[0].properties.type,r=`<P class="item_head">${i}</p>\n          <div class="item_name">地址：<span class="item_val">${s}</span></div>\n          <div class="item_name">类型：<span class="item_val">${l}</span></div>`;a.setLngLat(o).setHTML(r).addTo(t)})),t.on("mouseleave","searchPoints",(function(){t.getCanvas().style.cursor="",a.remove()}))},addMeasureRes(e,t){let a=this.local_map,o=document.createElement("div");o.setAttribute("class","measure_result");let i={element:o,anchor:"center",offset:[0,20]};o.innerHTML=t;var s=new this.mbgl.Marker(i);s.setLngLat(e).addTo(a)},setIsochronous(e){console.log("等时圈json",e);let t=this.local_map,a=t.getSource("isoline_source");a?t.getSource("isoline_source").setData(e):(t.addSource("isoline_source",{type:"geojson",data:e}),t.addLayer({id:"isoline_fill",type:"fill",source:"isoline_source",paint:{"fill-color":"#3bb2d0","fill-opacity":.1}}),t.addLayer({id:"isoline_line",type:"line",source:"isoline_source",layout:{},paint:{"line-color":"#3bb2d0","line-width":1,"line-opacity":1}}));let o="",i=e.features[0].geometry.coordinates[0];i.forEach(e=>{o+=`${e[0]},${e[1]};`}),this.$store.dispatch("setEnclosureCoor",o),console.log(o)},measureEvent(){var e=this,t=e.local_map;t.on("click",t=>{if(e.measureLengthState){var a=[t.lngLat.lng,t.lngLat.lat];e.addMeasureMaker(a),e.addPoint(a),e.points.push(a)}if(e.measureAreaState){a=[t.lngLat.lng,t.lngLat.lat];e.points.push(a),e.addAreaPoint(a)}}),t.on("mousemove",a=>{if(e.measureLengthState){var o=[a.lngLat.lng,a.lngLat.lat];if(e.jsonPoint.features.length>0){var i=e.jsonPoint.features[e.jsonPoint.features.length-1],s={type:"Feature",geometry:{type:"LineString",coordinates:[i.geometry.coordinates,o]}};t.getSource("line-move").setData(s),e.measureTip.innerHTML=e.getLength(o)}else e.measureTip.innerHTML="点击测量-双击结束";e.tooltip.setLngLat(o)}if(e.measureAreaState){o=[a.lngLat.lng,a.lngLat.lat];var l=e.jsonPoint.features.length;if(0===l)e.measureTip.innerHTML="点击测量-双击结束";else if(1===l)e.measureTip.innerHTML="点击继续绘制-双击结束";else{var r=e.points.concat([o]);r=r.concat([e.points[0]]);s={type:"Feature",geometry:{type:"Polygon",coordinates:[r]}};t.getSource("line-area").setData(s),e.measureTip.innerHTML=e.getArea(o)}e.tooltip.setLngLat(o)}}),t.on("dblclick",a=>{if(e.measureLengthState){var o=[a.lngLat.lng,a.lngLat.lat];e.addPoint(o),e.measureLengthState=!1,t.getCanvas().style.cursor="",e.tooltip.remove(),e.tooltip=null;const s=document.createElement("div");s.setAttribute("class","measure-result close");var i={element:s,anchor:"bottom-left",offset:[-5,-10]};s.innerHTML="×",new e.mbgl.Marker(i).setLngLat(o).addTo(t),s.onclick=function(a){a.stopPropagation(),t.doubleClickZoom.enable(),e.clearMeasure()}}if(e.measureAreaState){o=[a.lngLat.lng,a.lngLat.lat];e.points.push(o),e.measureAreaState=!1,t.getCanvas().style.cursor="",e.jsonPoint.features=[],e.jsonLine.features=[],e.tooltip.remove(),e.tooltip=null;var s=document.createElement("div");s.setAttribute("class","measure-result");var l={element:s,anchor:"bottom-left",offset:[-5,-10]};let n=e.getCenterCoor(o);s.innerHTML=e.getArea(o),new e.mbgl.Marker(l).setLngLat(n).addTo(t);var r=document.createElement("div");r.setAttribute("class","measure-result close");i={element:r,anchor:"bottom-left",offset:[-5,-10]};r.innerHTML="×",new e.mbgl.Marker(i).setLngLat(o).addTo(t),r.onclick=function(a){a.stopPropagation(),t.doubleClickZoom.enable(),e.clearMeasure()},this.$store.dispatch("setMesureState",!1)}})},measureLength(){var e=this,t=this.local_map;if(e.clearMeasure(),null===e.tooltip){e.measureTip=document.createElement("div"),e.measureTip.setAttribute("class","measure-result"),e.measureTip.innerHTML="点图上点击开始测量";var a={element:e.measureTip,anchor:"left",offset:[8,0]};e.tooltip=new e.mbgl.Marker(a).setLngLat([0,0]).addTo(t)}t.doubleClickZoom.disable(),t.getCanvas().style.cursor="crosshair";var o=e.jsonPoint,i=e.jsonLine,s=t.getSource("points");s?(t.getSource("points").setData(o),t.getSource("line-move").setData(i),t.getSource("line").setData(i)):(t.addSource("points",{type:"geojson",data:o}),t.addSource("line",{type:"geojson",data:i}),t.addSource("line-move",{type:"geojson",data:i}),t.addLayer({id:"line-move",type:"line",source:"line-move",paint:{"line-color":"#ff0000","line-width":2,"line-opacity":.65}}),t.addLayer({id:"line",type:"line",source:"line",paint:{"line-color":"#ff0000","line-width":2,"line-opacity":.65}}),t.addLayer({id:"points",type:"circle",source:"points",paint:{"circle-color":"#ffffff","circle-radius":3,"circle-stroke-width":2,"circle-stroke-color":"#ff0000"}}))},clearMeasure(){var e=this,t=this.local_map;e.$(".measure-result").remove();var a=t.getSource("points"),o={type:"FeatureCollection",features:[]};a&&(t.getSource("points").setData(o),t.getSource("line-move").setData(o),t.getSource("line").setData(o));var i=t.getSource("points-area");i&&(t.getSource("points-area").setData(o),t.getSource("line-area").setData(o)),this.points=[],this.markers=[],this.jsonPoint={type:"FeatureCollection",features:[]},this.jsonLine={type:"FeatureCollection",features:[]}},addPoint(e){var t=this.local_map,a=this.jsonPoint;if(this.measureLengthState&&a.features.length>0){var o=a.features[a.features.length-1];this.jsonLine.features.push({type:"Feature",geometry:{type:"LineString",coordinates:[o.geometry.coordinates,e]}}),t.getSource("line").setData(this.jsonLine)}this.jsonPoint.features.push({type:"Feature",geometry:{type:"Point",coordinates:e}}),t.getSource("points").setData(a)},getLength(e){var t=this.points.concat([e]),a=v["lineString"](t),o=v["length"](a);return o=o<1?Math.round(1e3*o)+"m":o.toFixed(2)+"km",o},addMeasureMaker(e){var t=this.local_map,a=document.createElement("div");a.setAttribute("class","measure-result");var o={element:a,anchor:"left",offset:[8,0]};a.innerHTML=0===this.points.length?"起点":this.getLength(e);var i=new this.mbgl.Marker(o).setLngLat(e).addTo(t);this.markers.push(i)},measureArea(){var e=this,t=this.local_map;if(e.clearMeasure(),null===e.tooltip){e.measureTip=document.createElement("div"),e.measureTip.setAttribute("class","measure-result"),e.measureTip.innerHTML="点图上点击开始测量";var a={element:e.measureTip,anchor:"top",offset:[0,-35]};e.tooltip=new e.mbgl.Marker(a).setLngLat([0,0]).addTo(t)}t.doubleClickZoom.disable(),t.getCanvas().style.cursor="crosshair";var o=t.getSource("points-area"),i=e.jsonPoint,s=e.jsonLine;o?(t.getSource("points-area").setData(i),t.getSource("line-area").setData(s)):(t.addSource("points-area",{type:"geojson",data:i}),t.addSource("line-area",{type:"geojson",data:s}),t.addLayer({id:"line-area",type:"fill",source:"line-area",paint:{"fill-color":"#ff0000","fill-opacity":.1}}),t.addLayer({id:"line-area-stroke",type:"line",source:"line-area",paint:{"line-color":"#ff0000","line-width":2,"line-opacity":.65}}),t.addLayer({id:"points-area",type:"circle",source:"points-area",paint:{"circle-color":"#ffffff","circle-radius":3,"circle-stroke-width":2,"circle-stroke-color":"#ff0000"}}))},getArea(e){var t=this.points.concat([e]);t=t.concat([this.points[0]]);var a=v["polygon"]([t]),o=v["area"](a);o=Math.round(o);var i=(.0015*o).toFixed(2),s=o+" ㎡; "+i+" 亩";return s},getCenterCoor(e){var t=this.points.concat([e]);t=t.concat([this.points[0]]);var a=v["polygon"]([t]),o=v["center"](a).geometry.coordinates;return o},addAreaPoint(e){var t=this.local_map;this.jsonPoint.features.push({type:"Feature",geometry:{type:"Point",coordinates:e}}),t.getSource("points-area").setData(this.jsonPoint)}}},z=A,I=(a("49fd"),Object(l["a"])(z,m,h,!1,null,null,null)),D=I.exports,$=a("73ef"),O=a.n($),H={name:"Home",components:{Map:D},data(){return{swords:[{coordinate:"116.41113307958986,39.949102930147106",name:"大卫王"},{coordinate:"104.03656458130820,30.588482557822758",name:"彪彪"},{coordinate:"113.90530127116395,22.529352820096197",name:"狗子哥"},{coordinate:"113.94967602269357,22.530769175884647",name:"雫"},{coordinate:"120.40546755258976,36.185750200997090",name:"老何"},{coordinate:"117.17668904434204,31.839912482865845",name:"顶顶"},{coordinate:"120.62068171163940,31.263083367533490",name:"坤坤"},{coordinate:"108.99605882453918,34.269488637808784",name:"碎落星沉"},{coordinate:"116.41905774090574,40.027328559551165",name:"紫苜"},{coordinate:"114.32466419067386,29.831808386255010",name:"白给"},{coordinate:"104.04125233882905,30.630496394258740",name:"我不是新人"},{coordinate:"113.34650148365782,23.143999892753552",name:"倘若"},{coordinate:"120.08295836499023,30.313287696779017",name:"希希"},{coordinate:"112.47094068031984,34.612638347246860",name:"干粮"},{coordinate:"120.09094545696252,30.312138348746604",name:"葵葵"},{coordinate:"108.88602191401674,34.215078327677396",name:"小七爸爸"},{coordinate:"113.94948587051393,22.569020257346570",name:"阿信"},{coordinate:"116.42128933880613,39.779908103179594",name:"有为"},{coordinate:"118.79231142195131,31.932585957283543",name:"万里"},{coordinate:"120.10940413685810,30.282109764142450",name:"小恐龙"},{coordinate:"116.23516549084471,40.08110227591025",name:"小秦"},{coordinate:"104.03928271834769,30.676244094831578",name:"图图"},{coordinate:"120.98492405334474,30.921111536667944",name:"小金猊"},{coordinate:"121.24361497043957,31.360764319719586",name:"牛妹"},{coordinate:"116.37278158877180,39.877978201497710",name:"太白"},{coordinate:"118.06722153637693,24.571764620098385",name:"5t5"},{coordinate:"116.47432197544859,40.019597359598360",name:"空空"},{coordinate:"112.62797779629516,34.626885568896480",name:"晴朗"},{coordinate:"114.41467377111860,30.484916549819292",name:"胡歌的腿毛"},{coordinate:"117.13231076214598,31.803158856273180",name:"盖亚"},{coordinate:"116.33532990429686,40.076702112310564",name:"对方正在输入中"},{coordinate:"121.31916800000000,31.046414705840217",name:"麻吉"},{coordinate:"111.50080086444856,27.218263012785233",name:"M"},{coordinate:"113.34174289713708,23.099218797391572",name:"小瑞瑞"},{coordinate:"104.04829027881112,30.705287025921535",name:"半点"},{coordinate:"116.67978012796519,39.843986682326175",name:"码奴"},{coordinate:"113.38694956897733,23.128649265879282",name:"小方"},{coordinate:"113.88326212297079,22.554126873227190",name:"Maggie"},{coordinate:"116.45926941845701,39.827721860134490",name:"清崽"},{coordinate:"103.98451658843388,30.619920343069353",name:"恦"},{coordinate:"111.50457910644879,27.211422559444696",name:"及时行乐"},{coordinate:"120.12057674955024,30.356680218797860",name:"zwb"},{coordinate:"112.61689801814424,26.867951961745792",name:"こびと"},{coordinate:"116.91595162502288,36.693282717706570",name:"不易"},{coordinate:"116.49503935787962,39.894420866819274",name:"404"},{coordinate:"116.41812516713725,39.957461296631635",name:"鸭妹"},{coordinate:"108.35625034970377,35.489072386705630",name:"点点"}]}},methods:{getMap(e){this.map=e,console.log(e),e.on("load",e=>{this.setPoint(this.swords),this.centroid()}),setTimeout(t=>{console.log(e)},3e3)},setPoint(e){let t=this.map,a={type:"FeatureCollection",features:[]};e.forEach(e=>{if(e.coordinate){let t=e.coordinate.split(",");a.features.push({type:"Feature",geometry:{type:"Point",coordinates:t},properties:{title:e.name,point:e.coordinate.split(","),color:e.isJoin}})}});let o=t.getSource("goodsSource");void 0==o&&(t.addSource("goodsSource",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addLayer({id:"goodsPoints",type:"circle",source:"goodsSource",paint:{"circle-color":"#fcbf49","circle-radius":6,"circle-stroke-width":.5,"circle-stroke-color":"white","circle-pitch-scale":"viewport","circle-stroke-opacity":.5}}),t.addLayer({id:"goodsName",type:"symbol",source:"goodsSource",paint:{"text-color":"#11b4da"},layout:{"symbol-placement":"point","text-field":"{title}","text-offset":[0,-2],"text-anchor":"top","icon-allow-overlap":!0,"icon-ignore-placement":!0}})),t.getSource("goodsSource").setData(a)},centroid(){let e=[];this.swords.forEach(t=>{e.push([1*t.coordinate.split(",")[0],1*t.coordinate.split(",")[1]])});let t=0,a=0;for(let i=0;i<e.length;i++)t+=e[i][0],a+=e[i][1];console.log(t,a);let o=[t/e.length,a/e.length];console.log(o),this.setCentroidLayer(o)},setCentroidLayer(e){let t=this.map;t.flyTo({pitch:45});var a=100;let o=t.getSource("pointSource");if(void 0===o){var i={width:a,height:a,data:new Uint8Array(a*a*4),onAdd:function(){var e=document.createElement("canvas");e.width=this.width,e.height=this.height,this.context=e.getContext("2d")},render:function(){var e=1e3,o=performance.now()%e/e,i=a/2*.3,s=a/2*.7*o+i,l=this.context;return l.clearRect(0,0,this.width,this.height),l.beginPath(),l.arc(this.width/2,this.height/2,s,0,2*Math.PI),l.fillStyle="rgba(255, 200, 200,"+(1-o)+")",l.fill(),l.beginPath(),l.arc(this.width/2,this.height/2,i,0,2*Math.PI),l.fillStyle="rgba(255, 100, 100, 1)",l.strokeStyle="white",l.lineWidth=2+4*(1-o),l.fill(),l.stroke(),this.data=l.getImageData(0,0,this.width,this.height).data,t.triggerRepaint(),!0}};t.addImage("land-dot",i,{pixelRatio:2}),t.addSource("pointSource",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:e}}]}}),t.addLayer({id:"house_point",type:"symbol",source:"pointSource",layout:{"icon-image":"land-dot"}})}t.getSource("pointSource").setData({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:e}}]})},getCircleData(e){O.a.get("https://api.mapbox.com/isochrone/v1/mapbox/driving/"+e.join(",")+"?contours_minutes=60&polygons=true&access_token=pk.eyJ1IjoiMTU5MDk4Mzk1NjQiLCJhIjoiY2tpZmt0MThrMGtwcTJ5bngxN2xqNnYzeCJ9.erBGt3UuT5gNjeD-d_p_VA").then(e=>{this.setTimeCircle(e.data.features[0])})},setTimeCircle(e){let t=this.map,a=t.getSource("timeCircle");void 0===a&&(t.addSource("timeCircle",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addLayer({id:"timeCircle_fill",type:"fill",source:"timeCircle",layout:{},paint:{"fill-color":"#fcbf49","fill-opacity":.2}}),t.addLayer({id:"timeCircle_line",type:"line",source:"timeCircle",layout:{},paint:{"line-color":"#fcbf49","line-opacity":1}})),t.getSource("timeCircle").setData({type:"FeatureCollection",features:[e]})}},mounted(){}},N=H,B=(a("0404"),Object(l["a"])(N,d,u,!1,null,"09224d71",null)),R=B.exports;o["default"].use(p["a"]);const q=[{path:"/",name:"Home",component:R}],W=new p["a"]({mode:"history",base:"/",routes:q});var J=W,Z=a("7736");o["default"].use(Z["a"]);var G=new Z["a"].Store({state:{},mutations:{},actions:{},modules:{}}),Y=a("51c0"),U=a.n(Y),V=a("0e4f"),Q=a.n(V);a("f0a3"),a("17cf"),a("31a3"),a("f419"),a("52d1");o["default"].prototype.$=L.a,o["default"].prototype.mbgl=Q.a,o["default"].config.productionTip=!1,o["default"].use(U.a),new o["default"]({router:J,store:G,render:function(e){return e(c)}}).$mount("#app")},"5c0b":function(e,t,a){"use strict";a("d766")},"64c6":function(e,t,a){},7385:function(e,t,a){},d766:function(e,t,a){},f0a3:function(e,t,a){}});
//# sourceMappingURL=app.2d39eec9.js.map